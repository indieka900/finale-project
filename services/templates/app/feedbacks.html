{% extends "base.html" %} {% block style %}
<style>
    .message-container {
        max-width: 600px; /* Set your desired maximum width */
        margin: 0 auto; /* Center the container horizontally */
        padding: 20px;
        background-color: #f9f9f9;
        border: 1px solid #ddd;
        border-radius: 10px;
        overflow-y: auto; /* Enable vertical scrolling */
        scroll-behavior: smooth;
    }


    /* Styling for sender's name */
    .message-container {
        max-width: 85%; /* Set your desired maximum width */
        margin: 0 auto; /* Center the container horizontally */
        padding: 20px;
        background-color: #ffffff;
        border: 1px solid #ddd;
        border-radius: 10px;
        overflow-y: auto; /* Enable vertical scrolling */
        max-height: 400px; /* Set the maximum height for scrollability */
    }

    /* Styling for individual messages */
    .message {
        margin-bottom: 15px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    /* Styling for sender's name */
    .sender-name {
        font-weight: bold;
        color: #007bff; /* Blue color for sender's name */
    }

    /* Styling for message text */
    .message-text {
        margin-top: 5px;
    }

    .file-link {
        color: #0066cc;  /* Set the color you prefer */
        text-decoration: underline;
        cursor: pointer;
    }

    .file-link:hover {
        text-decoration: none;  /* Remove underline on hover if desired */
    }

    /* Styling for images */
    .image {
        max-width: 30%;
        height: auto;
    }
    .read-icon {
        color: green;  /* Color for read messages */
    }

    .unread-icon {
        color: red;  /* Color for unread messages */
    }
</style>
{% endblock %} {% block body %}
{% load my_filters %}
<section class="dashboard">
    <div class="top">
        <i class="uil uil-bars sidebar-toggle"></i>

        <span class="logo_name">
            <h1>ICT SUPPORT TICKETING SYSTEM</h1>
        </span>

        <div>
            <a href="#D0" class="notification">
                <span>Tickets</span>
                <span id="mydiv" class="badge">2</span>
            </a>
        </div>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    </div>
    <ul class="tab-content">
        <li id="D0">
            <div class="dash-content">
                <div class="overview">
                    <div class="title">
                        <i class="uil uil-clock-three"></i>
                        <span class="text">Recent Activity</span>
                    </div>
                    <h2>{{ complaint.message|capfirst  }}</h2>
                </div>
            </div>

            <div class="message-container" id="messageContainer">
                {% for message in feedbacks %}
                <div class="message">
                    <p> <span class="sender-name">{% if user == message.sender %} You 
                        {% else %} {{ message.sender.username|capfirst }} 
                        {% endif %} </span>: {{message.date_posted|timesince}} ago.
                        {% if feedback.read %}
                        <span class="read-icon">&#10004;</span>  <!-- Tick icon for read messages -->
                        {% else %}
                            <span class="unread-icon">&#10008;</span>  <!-- Double tick icon for unread messages -->
                        {% endif %}
                    </p>
                    <p class="message-text">{{ message.message }}</p>
                    {% if message.file %}
                        {% with file_type=message.file.name|get_file_type %} 
                        {% if file_type == "Image" %}
                        <a href="{{ message.file.url }}" target="_blank">
                            <img src="{{ message.file.url }}" alt="Image" class="image" />
                        </a>
                        {% elif file_type == "Word Document" %}
                        <div class="file-container">
                            <p>
                                This is a Word Document:
                                <a class="file-link" href="{{ message.file.url }}" target="_blank">{{ message.file.name }}</a>
                            </p>
                        </div>
                        {% elif file_type == "PDF" %}
                        <div class="file-container">
                            <p class="file-link">
                                <a href="{{ message.file.url }}" target="_blank">View PDF</a>
                            </p>
                        </div>
                        {% else %}
                        <p>Unsupported file type: {{ file_type }}</p>
                        {% endif %}

                        {% endwith %}
                    {% endif %} 
                </div>
                {% endfor %}
            </div>

            <!-- <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <label for="complaint">complaint:</label>
        <input type="text" name="message" required />

        <label for="file">File:</label>
        <input type="file" name="file" />

        <button type="submit">Send</button>
      </form> -->
            <div class="activity">
                <div class="activity-data">
                    <div class="complaint" id="ticket">
                        <form class="complaintS" method="post" action="" enctype="multipart/form-data"
                            name="complaintS">
                            {% csrf_token %}
                            <!--<form class="complaintS" name="complaintS" onsubmit="return submitResult();"> -->
                            <center>
                                <h3>Fill in the user support form</h3>
                            </center>

                            <textarea name="message" id="descr" cols="30" rows="3"
                                placeholder="Write FeedBack"></textarea>

                            <label for="myfile">Select a file:</label>
                            <input type="file" id="myfile" name="file" />
                            <center>
                                <button type="submit" name="create-comp">Submit</button>
                            </center>
                        </form>
                    </div>
                </div>
            </div>
        </li>
    </ul>
</section>

<script>
    // Scroll to the bottom of the message container
    var messageContainer = document.getElementById('messageContainer');
    messageContainer.scrollTop = messageContainer.scrollHeight;
</script>
{% endblock body %}