{% extends "base.html" %} {% block style %}
<style>
    .message-container {
        max-width: 600px; /* Set your desired maximum width */
        margin: 0 auto; /* Center the container horizontally */
        padding: 20px;
        background-color: #f9f9f9;
        border: 1px solid #ddd;
        border-radius: 10px;
        overflow-y: auto; /* Enable vertical scrolling */
        scroll-behavior: smooth;
    }


    /* Styling for sender's name */
    .message-container {
        max-width: 85%; /* Set your desired maximum width */
        margin: 0 auto; /* Center the container horizontally */
        padding: 20px;
        background-color: #ffffff;
        border: 1px solid #ddd;
        border-radius: 10px;
        overflow-y: auto; /* Enable vertical scrolling */
        max-height: 400px; /* Set the maximum height for scrollability */
    }

    /* Styling for individual messages */
    .message {
        margin-bottom: 15px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    /* Styling for sender's name */
    .sender-name {
        font-weight: bold;
        color: #007bff; /* Blue color for sender's name */
    }

    /* Styling for message text */
    .message-text {
        margin-top: 5px;
    }

    .file-link {
        color: #0066cc;  /* Set the color you prefer */
        text-decoration: underline;
        cursor: pointer;
    }

    .file-link:hover {
        text-decoration: none;  /* Remove underline on hover if desired */
    }

    /* Styling for images */
    .image {
        max-width: 30%;
        height: auto;
    }
    .read-icon {
        color: green;  /* Color for read messages */
    }

    .unread-icon {
        color: red;  /* Color for unread messages */
    }
    svg {
        width: 50px;
        height: 30px;
        padding: 0px;
        margin: 0px;
    }
</style>
{% endblock %} {% block body %}
{% load my_filters %}

    <ul class="tab-content">
        <li id="D0">
            <div class="dash-content">
                <div class="overview">
                    <div class="title">
                        <i class="uil uil-clock-three"></i>
                        <span class="text">Recent Activity</span>
                    </div>
                    <h2>{{ complaint.message|capfirst  }}</h2>
                </div>
            </div>

            <div class="message-container" id="messageContainer">
                {% for message in feedbacks %}
                <div class="message">
                    <p> <span class="sender-name">{% if user == message.sender %} You 
                        {% else %} {{ message.sender.username|capfirst }} 
                        {% endif %} </span>: {{message.date_posted|timesince}} ago.
                        {% if not message.read %}
                        <span class="read-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="tick"><path d="M223.9 329.7c-2.4 2.4-5.8 4.4-8.8 4.4s-6.4-2.1-8.9-4.5l-56-56 17.8-17.8 47.2 47.2L340 177.3l17.5 18.1-133.6 134.3z" fill="#011230" class="color000000 svgShape"></path></svg>

                        </span>  <!-- Tick icon for read messages -->
                        {% else %}
                        <span class="read-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="tick"><path d="M223.9 329.7c-2.4 2.4-5.8 4.4-8.8 4.4s-6.4-2.1-8.9-4.5l-56-56 17.8-17.8 47.2 47.2L340 177.3l17.5 18.1-133.6 134.3z" fill="#34a853" class="color000000 svgShape"></path></svg>
                        </span>  
                        {% endif %}
                    </p>
                    <p class="message-text">{{ message.message }}</p>
                    {% if message.file %}
                        {% with file_type=message.file.name|get_file_type %} 
                        {% if file_type == "Image" %}
                        <a href="{{ message.file.url }}" target="_blank">
                            <img src="{{ message.file.url }}" alt="Image" class="image" />
                        </a>
                        {% elif file_type == "Word Document" %}
                        <div class="file-container">
                            <p>
                                This is a Word Document:
                                <a class="file-link" href="{{ message.file.url }}" target="_blank">{{ message.file.name }}</a>
                            </p>
                        </div>
                        {% elif file_type == "PDF" %}
                        <div class="file-container">
                            <p class="file-link">
                                <a href="{{ message.file.url }}" target="_blank">View PDF</a>
                            </p>
                        </div>
                        {% else %}
                        <p>Unsupported file type: {{ file_type }}</p>
                        {% endif %}

                        {% endwith %}
                    {% endif %} 
                </div>
                {% endfor %}
            </div>
            <div class="activity">
                <div class="activity-data">
                    <div class="complaint" id="ticket">
                        <form class="complaintS" method="post" action="" enctype="multipart/form-data"
                            name="complaintS">
                            {% csrf_token %}
                            <!--<form class="complaintS" name="complaintS" onsubmit="return submitResult();"> -->
                            <center>
                                <h3>Fill in the user support form</h3>
                            </center>

                            <textarea name="message" id="descr" cols="30" rows="3"
                                placeholder="Write FeedBack"></textarea>

                            <label for="myfile">Select a file:</label>
                            <input type="file" id="myfile" name="file" />
                            <center>
                                <button type="submit" name="create-comp">Submit</button>
                            </center>
                        </form>
                    </div>
                </div>
            </div>
        </li>
    </ul>

<script>
    // Scroll to the bottom of the message container
    var messageContainer = document.getElementById('messageContainer');
    messageContainer.scrollTop = messageContainer.scrollHeight;
</script>
{% endblock body %}